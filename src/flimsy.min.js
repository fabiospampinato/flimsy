var l,i,u=!1,o=Symbol(),a=class{static wrap(t,e,s){let f=i,b=u;i=e,u=s;try{return t()}catch(p){let d=e?.get(o);if(d)d.forEach(v=>v(p));else throw p}finally{i=f,u=b}}},c=class{constructor(t,{equals:e}={}){this.observers=new Set;this.get=()=>(u&&i instanceof r&&(this.observers.add(i),i.signals.add(this)),this.parent?.waiting&&this.parent.update(),this.value);this.set=t=>{let e=t instanceof Function?t(this.value):t;return this.equals(this.value,e)||(l?l.set(this,e):(this.value=e,this.stale(1,!0),this.stale(-1,!0))),this.value};this.stale=(t,e)=>{this.observers.forEach(s=>{s.stale(t,e)})};this.value=t,this.equals=e===!1?()=>!1:e||Object.is}},T=class{constructor(){this.parent=i;this.cleanups=[];this.contexts={};this.observers=new Set;this.signals=new Set;this.dispose=()=>{this.observers.forEach(t=>{t.dispose()}),this.signals.forEach(t=>{t.observers.delete(this)}),this.cleanups.forEach(t=>{t()}),this.cleanups=[],this.contexts={},this.observers=new Set,this.signals=new Set,this.parent?.observers.delete(this)};this.get=t=>t in this.contexts?this.contexts[t]:this.parent?.get(t);this.set=(t,e)=>{this.contexts[t]=e}}},h=class extends T{wrap(t){let e=()=>t(this.dispose);return a.wrap(e,this,!1)}},r=class extends T{constructor(e,s){super();this.waiting=0;this.fresh=!1;this.run=()=>(this.dispose(),this.parent?.observers.add(this),a.wrap(this.fn,this,!0));this.update=()=>{this.waiting=0,this.fresh=!1,this.signal.set(this.run)};this.stale=(e,s)=>{!this.waiting&&e<0||(!this.waiting&&e>0&&this.signal.stale(1,!1),this.waiting+=e,this.fresh||(this.fresh=s),this.waiting||(this.waiting=0,this.fresh&&this.update(),this.signal.stale(-1,!1)))};this.fn=e,this.signal=new c(this.run(),s),this.signal.parent=this}};function g(n,t){let{get:e,set:s}=new c(n,t);return[e,s]}function w(n){new r(n)}function C(n,t){return new r(n,t).signal.get}function y(n){return new h().wrap(n)}function x(n){let t=Symbol();return{id:t,defaultValue:n,get:()=>i?.get(t)??n,set:f=>i?.set(t,f)}}function E(n){return n.get()}function S(){return i}function k(n,t){let e=n instanceof r;return a.wrap(t,n,e)}function O(n){i?.cleanups.push(n)}function F(n){var t;i&&((t=i.contexts)[o]||(t[o]=[]),i.contexts[o].push(n))}function m(n){if(l)return n();let t=l=new Map;try{return n()}finally{l=void 0,t.forEach((e,s)=>s.stale(1,!1)),t.forEach((e,s)=>s.set(()=>e)),t.forEach((e,s)=>s.stale(-1,!1))}}function R(n){return a.wrap(n,i,!1)}export{m as batch,x as createContext,w as createEffect,C as createMemo,y as createRoot,g as createSignal,S as getOwner,O as onCleanup,F as onError,k as runWithOwner,R as untrack,E as useContext};
